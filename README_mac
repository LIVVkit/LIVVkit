Information on how to run the Land Ice V&V (LIVV) Post-Processing Software.
KJE, AB, NM 2/2014

The /PISCEES/trunk/tests/higher-order/livv directory contains all the scripts and code to run the LIVV kit.
The mac_VV.bash script contains the inputs needed to run on an OSX machine.
Scripts for Carver (NERSC) and Rhea (OLCF) are also provided.

Software needed for LIVV:

  Packages via MacPorts (versions as of 2/2014):
      1. python27
      2. py-netcdf4 @1.0.4
      3. py-numpy @1.8.0
      5. nco @4.4.0
      6. netcdf @4.3.0
      7. udunits2 @2.1.24
      8. hdf5 @1.6.9

  Packages not available via MacPorts (versions as of 2/2014):
      5. download Mac OSX NCL binary for 10.7 (instructions listed below)

      To install NCL go here:
      <http://www.earthsystemgrid.org/dataset/ncl.612.0.html>, download the latest
      Mac OSX binary for 10.7, even if you have 10.8, just pretend. Unpack it and
      move it where you want it.
      Set NCARG_ROOT to the NCL directory, and add
      $NCARG_ROOT/bin to the PATH environment variable. Best to do those in your
      .bashrc so you don't have to think about it again.

Filepaths for the python script are defined in the bash shell script, and most are required.
The command to run the python script along with all of the necessary/optional files is the last line of the script. 

/livv/bin: the python processing code 
/livv/plots: the ncl scripts 
/livv/data: the solver data from each processed run is placed here in a $case.asc format 

To run the shell script (Mac OS X):

  1. Copy the reg_test directory from /ccs/proj/cli062/ on rhea or titan (choose the tar file with the most recent date stamp),
     untar it and place in a new directory (ex. mac_run, higher-order) on your mac. This will be the same directory as
     specified as TEST_DIR in the /PISCEES/trunk/cmake-scripts/master_build_mac.csh file. Go ahead and copy the entire
     /PISCEES/trunk/tests/higher-order/livv directory and place in this new directory as well.

  2. Now run the /PISCEES/trunk/cmake-scripts/master_build_mac.csh file on your mac (see /PISCEES/trunk/cmake-scripts/README
     for more information on how to run the csh script). Make sure the TEST_DIR is set to the directory that you created
     in step #1. Also make sure the tests you want to run and analyze on your machine later are selected in the csh file.
     The jobs in reg_test will be automatically run by this csh script (as long as the path is correctly specified) after
     the model is successfully built. Once the model is built and the jobs are submitted, you will then go into the livv
     directory in the path set above and run livv to post-process all of the tests you just ran. 

To set up the livv executable /livv/mac_VV.bash (this can be done after you run the master_build_mac.csh file):

  3. Change MY_PYTHON to wherever your python2.7 package exists on your mac.
  
  4. There is an opportunity to insert a COMMENT to display your reason for running livv on the website.
  
  5. Change the TEST_FILEPATH to the path containing the livv directory (the directory mentioned in step #1).

  6. Change the HTML_PATH to the location of the www directory. If it doesn't already exist, specify the path to where
     you would like it and LIVV will check the path and create it if it is not already there. An example path is already
     in the bash file that you may try. If you have posted html pages from your mac previously, you can point livv to
     whatever html directory you have used and livv will create a sub-directory where it will store all of its own html
     files, therefore not disrupting the rest of your workspace.

  7. The verification flags are pre-set in the bash script for what will be analyzed on the mac. Note that you can
     adjust which testcases you would like livv to run within the mac_VV.bash script by changing the flag from a
     0 to 1. If you have just recently checked out the code, the flags should already be set for the tests that are
     run by the software on the machine. Mac can only run a subset of the tests due to the capacity of the machine.
     Those tests are highlighted in the mac_VV.bash script to avoid any confusion. However, you are of course
     not required to run all 5 tests that the machine processes. You are allowed to select any sub-set and combination
     of the tests. Leave RUN_ANT=0 in the mac_VV.bash script since Antarctica analysis will not be run locally.

To run livv:

  8. Type "bash mac_VV.bash" in the command line in the /livv/ directory. When it is finished running, the website
     location will be printed to the screen where you can look at the output.
     We have piped the ncl output to a file called plot_details.out. So if there is any concern over whether plots
     have formed correctly after inspecting the website, you can look in that file.



TODOs (feel free to add to this as needed)

Major:
*create a more general user interface to process the GIS production output
*enable the option to read from FELIX data (in exodus format) using visit

Minor:
*have the input and output information from the benchmark runs set in the software rather than the user 
specify (or at least have a default)
*parse more detailed data from the output files about the solver and preconditioner
n VV_outprocess
