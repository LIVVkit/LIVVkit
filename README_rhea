Information on how to run the Land Ice V&V (LIVV) Post-Processing Software.
KJE, AB, NM 8/2014

The /PISCEES/trunk/tests/higher-order/livv/ directory contains all the scripts and code to run LIVV.
The rhea_VV.bash script contains the inputs needed to run on a data processing style machine (OLCF).
The rhea script is run after the model is built and run on Titan (OLCF). Then you will switch over to Rhea (OLCF).
Scripts for Carver (NERSC) and Mac OSX (local) are provided.

If you want to run on another machine, these are the software packages and versions that worked 
on both NERSC and OLCF machines as of 12/2013:
	    1. hdf5/1.8.6
	    2. python/2.7.3
	    3. netcdf4-python/1.0 (NERSC is 1.0.6)
	    4. python_numpy/1.7.1            
	    5. ncl/6.0.0  (at NERSC this is called, inexplicably, ncar/6.0.0)  
	    6. nco/4.0.7 (NERSC is 4.3.6)
      7. netcdf/4.1.3 (NERSC is 4.2.1.1)

Filepaths for the python script are defined in the rhea_VV.bash script, and most are required.
The paths that need input from the user are between the ************************ lines.
The command to run the python script along with all of the necessary/optional files is the last line of the script. 

/livv/bin: the python processing code 
/livv/plots: the ncl scripts 
/livv/data: the solver data from each processed run is placed here automatically in a $case.asc format 

To run the rhea_VV.bash script:

  1. Make sure to place "source $MODULESHOME/init/bash" in your .bashrc file.

  2. Create a higher-order directory in your scratch space if there is not one already.
     Place $TEST_DIR=$location_of_higher_order_directory in your .bashrc file in your home space and source it.
     (This should already be done for /PISCEES/trunk/builds/titan-gnu/titan-gnu-build-and-test.csh file which will
     be run on Titan before you run LIVV on Rhea.)

Log onto Titan:

  1. Go to the PISCEES code base and cd trunk/tests/higher-order/livv
  3. Now run the 'csh run_livv_on_titan.csh'
NOTE: This updated .csh file will now copy over the most recent reg_test and perf_test directories located in /ccs/proj/cli106.
     You can turn off the copying of reg_test by selecting the no-copy option
     It will monitor the jobs on titan until they are complete.
     Next, switch over to rhea and run LIVV once the above file has completed successfully.

Log onto Rhea (We are hoping to incorporate cross-submission capability soon that will allow LIVV to be run automatically from Titan after the file in step 3 has finished running):
  To set up the LIVV executable, copy over livv to your working area in the /higher-order ditrectory and 'cd livv'
  In rhea_VV.bash
  1. There is an opportunity to insert a COMMENT to display your reason for running LIVV on the website.

  2. If needed, change the TEST_FILEPATH to the path containing the higher-order directory (the directory mentioned in step #2).
     NOTE: This path is currently set to $TEST_DIR which should require no changing by the user, unless it is not set properly.

  3. Change the HTML_PATH to the location of the www directory. If it doesn't already exist, specify the path to where
     you would like it and LIVV will check the path and create it if it is not already there. For Titan/Rhea users, this is
     the www directory in your home space where your html files can be viewed on users.nccs.gov. LIVV will also create a
     sub-directory where it will store all of its own html files, therefore not disrupting the rest of your workspace.

  4. The verification flag options are listed and you may set the flags to however you would prefer, 0 = do not run, 1 = run. 

  5. The performance flag options are listed and you may set the flags to however you would prefer, 0 = do not run, 1 = run.
  
  6. The validation flag option is listed and you may set the flag to however you would prefer, 0 = do not run, 1 = run- this one is underconstruction so no guarantees it will do anything useful for you.

  7. RUN_ANT should be off since Antartica analysis is not set up yet.


  8. Type "bash rhea_VV.bash" in the command line in the /higher-order/livv/ directory. NOTE: This can only be done once the Titan
      script has finished running, or you will get an error. When it is finished running, the website location will be printed to
      the screen where you can go look at the output. 

The ncl plot output is sent to a file called plot_details.out. So if there are plot errors, go look in tha tfile for detials. 
The interation count output is sent to a file called plot_details.out. So if there are plot errors, go look in tha tfile for detials. 

